version: '3.8'

services:
  # 1. Database Service (PostgreSQL)
  s2_db:
    image: postgres:15-alpine
    container_name: s2_db
    restart: unless-stopped
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:
      - db_data:/var/lib/postgresql/data
    networks:
      - secure_internal
    # üîí Security: ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î Port 54324 ‡∏ó‡∏¥‡πâ‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
    # (No ports section)

  # 2. Database Admin Service (PgAdmin4)
  s2_admin:
    image: dpage/pgadmin4
    container_name: s2_admin
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_PASSWORD}
    ports:
      - "8090:80"
    depends_on:
      - s2_db
    networks:
      - secure_internal

  # 3. Application Service (Strapi)
  s2_app:
    image: prawee/strapi
    container_name: s2_app
    restart: unless-stopped
    environment:
      DATABASE_CLIENT: postgres
      # üîí Security: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≠‡∏°‡πÑ‡∏õ‡πÉ‡∏ä‡πâ host.docker.internal (‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å) 
      # ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ä‡∏∑‡πà‡∏≠ Service (s2_db) ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ Port ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (5432) ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÉ‡∏ô‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
      DATABASE_HOST: s2_db
      DATABASE_PORT: 5432
      DATABASE_NAME: ${POSTGRES_DB}
      DATABASE_USERNAME: ${POSTGRES_USER}
      DATABASE_PASSWORD: ${POSTGRES_PASSWORD}
    ports:
      - "8080:1337"
    depends_on:
      - s2_db
    networks:
      - secure_internal

# ‡∏à‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏≤‡∏¢‡∏ï‡∏≠‡∏ô‡∏õ‡∏¥‡∏î Container
volumes:
  db_data:

# üîí Security: ‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Å‡∏ß‡∏á‡∏õ‡∏¥‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á 3 Container ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
networks:
  secure_internal:
    driver: bridge
